#include <stdio.h>
#include "stm32f10x.h"
#include "SWD_host.h"
#include "SWD_flash.h"

// #include "Driver_USART.h"
// #include "Driver_SPI.h"
/*SWD引脚定义在DAP_config.h文件中*/

#define sector_size (4096)

// uint32_t Flash_Page_Size = 1024;
// uint32_t Flash_Start_Addr = 0x08000000;
uint32_t Flash_Page_Size = sector_size;
uint32_t Flash_Start_Addr = 0x00000000;

extern uint8_t demo1[988];
//extern uint8_t beep[];
//extern uint8_t led[];

// const uint8_t beep[]= {
//     0x08,0x20,0x00,0x20,0x8d,0x04,0x00,0x00,0x95,0x04,0x00,0x00,0x97,0x04,0x00,0x00,
//     0x99,0x04,0x00,0x00,0x9b,0x04,0x00,0x00,0x9d,0x04,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x9f,0x04,0x00,0x00,
//     0xa1,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0xa3,0x04,0x00,0x00,0xa5,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0xdf,0xf8,0x0c,0xd0,0x00,0xf0,0x54,0xf8,0x00,0x48,0x00,0x47,0x95,0x08,0x00,0x00,
//     0x08,0x20,0x00,0x20,0x40,0x1e,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,
//     0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,
//     0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,
//     0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,
//     0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,
//     0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,
//     0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,
//     0x00,0xbf,0x00,0xbf,0x00,0xbf,0xc5,0xd1,0x70,0x47,0x00,0x00,0x06,0x48,0x80,0x47,
//     0x06,0x48,0x00,0x47,0xfe,0xe7,0xfe,0xe7,0xfe,0xe7,0xfe,0xe7,0xfe,0xe7,0xfe,0xe7,
//     0xfe,0xe7,0xfe,0xe7,0xfe,0xe7,0xfe,0xe7,0xe5,0x04,0x00,0x00,0x01,0x04,0x00,0x00,
//     0x06,0x4c,0x07,0x4d,0x06,0xe0,0xe0,0x68,0x40,0xf0,0x01,0x03,0x94,0xe8,0x07,0x00,
//     0x98,0x47,0x10,0x34,0xac,0x42,0xf6,0xd3,0xff,0xf7,0x9e,0xff,0x4c,0x09,0x00,0x00,
//     0x6c,0x09,0x00,0x00,0x01,0x48,0x02,0x49,0x08,0x60,0x70,0x47,0x00,0x90,0xd0,0x03,
//     0x00,0x00,0x00,0x20,0x10,0xb5,0x00,0xf0,0x09,0xf9,0x10,0xb1,0x5c,0x48,0x5d,0x49,
//     0x48,0x67,0x00,0xf0,0x1b,0xf9,0x28,0xb1,0x5b,0x48,0x00,0x68,0xc0,0xf3,0x42,0x30,
//     0x5a,0x49,0x08,0x60,0x00,0xf0,0x3c,0xf9,0x28,0xb1,0x59,0x48,0x00,0x68,0x20,0xf0,
//     0x80,0x70,0x57,0x49,0x08,0x60,0x00,0xf0,0x4b,0xf9,0x48,0xb1,0x00,0x20,0x55,0x49,
//     0x08,0x60,0x4f,0xf0,0x80,0x41,0xc1,0xf8,0x10,0x01,0x50,0x49,0x09,0x1f,0x08,0x60,
//     0x00,0xf0,0x68,0xf9,0x18,0xb1,0x03,0x20,0x4c,0x49,0x64,0x31,0x08,0x60,0x00,0xf0,
//     0x79,0xf9,0x68,0xb1,0x05,0x20,0x4c,0x49,0x08,0x60,0x01,0x20,0x4a,0x49,0x78,0x31,
//     0x08,0x60,0x00,0x20,0x48,0x49,0x08,0x31,0x08,0x60,0x3f,0x20,0x09,0x1f,0x08,0x60,
//     0x00,0xf0,0x80,0xf9,0x00,0x28,0x55,0xd0,0x44,0x48,0x00,0x68,0x44,0x49,0x08,0x60,
//     0x42,0x48,0x00,0x1d,0x00,0x68,0x09,0x1d,0x08,0x60,0x40,0x48,0x08,0x30,0x00,0x68,
//     0x09,0x1d,0x08,0x60,0x3d,0x48,0x0c,0x30,0x00,0x68,0x09,0x1d,0x08,0x60,0x3b,0x48,
//     0x10,0x30,0x00,0x68,0x09,0x1d,0x08,0x60,0x38,0x48,0x14,0x30,0x00,0x68,0x09,0x1d,
//     0x08,0x60,0x36,0x48,0x18,0x30,0x00,0x68,0x35,0x49,0x20,0x31,0x08,0x60,0x33,0x48,
//     0x1c,0x30,0x00,0x68,0x09,0x1d,0x08,0x60,0x30,0x48,0x20,0x30,0x00,0x68,0x09,0x1d,
//     0x08,0x60,0x2e,0x48,0x24,0x30,0x00,0x68,0x09,0x1d,0x08,0x60,0x2b,0x48,0x28,0x30,
//     0x00,0x68,0x09,0x1d,0x08,0x60,0x29,0x48,0x2c,0x30,0x00,0x68,0x09,0x1d,0x08,0x60,
//     0x26,0x48,0x30,0x30,0x00,0x68,0x26,0x49,0x40,0x31,0x08,0x60,0x23,0x48,0x34,0x30,
//     0x00,0x68,0x09,0x1d,0x08,0x60,0x21,0x48,0x38,0x30,0x00,0x68,0x09,0x1d,0x08,0x60,
//     0x1e,0x48,0x3c,0x30,0x00,0x68,0x09,0x1d,0x08,0x60,0x1c,0x48,0x40,0x30,0x00,0x68,
//     0x09,0x1d,0x08,0x60,0x00,0xf0,0x48,0xf8,0x30,0xb1,0x13,0x48,0x14,0x30,0x00,0x68,
//     0x00,0xf0,0x4f,0x00,0x17,0x49,0x08,0x60,0x11,0x48,0x74,0x38,0x00,0x68,0x40,0xf4,
//     0x70,0x00,0x0f,0x49,0x74,0x39,0x08,0x60,0x00,0xbf,0x00,0xbf,0x00,0xbf,0xbf,0xf3,
//     0x4f,0x8f,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0xbf,0xf3,
//     0x6f,0x8f,0x00,0xbf,0x00,0xbf,0x00,0xbf,0xff,0xf7,0x3c,0xff,0x10,0xbd,0x00,0x00,
//     0x0d,0xf0,0xad,0xba,0x00,0xc0,0x07,0x40,0x44,0x02,0x00,0x10,0x3c,0x05,0x00,0x40,
//     0xfc,0xed,0x00,0xe0,0x0c,0x01,0x00,0x40,0x10,0x56,0x00,0x40,0x04,0x04,0x00,0x10,
//     0x20,0xc5,0x00,0x40,0xe4,0x0e,0x00,0x40,0x02,0xe0,0x08,0xc8,0x12,0x1f,0x08,0xc1,
//     0x00,0x2a,0xfa,0xd1,0x70,0x47,0x70,0x47,0x00,0x20,0x01,0xe0,0x01,0xc1,0x12,0x1f,
//     0x00,0x2a,0xfb,0xd1,0x70,0x47,0x00,0x00,0x13,0x48,0x00,0x78,0x06,0x28,0x20,0xd1,
//     0x11,0x48,0x00,0x1d,0x00,0x78,0x00,0xf0,0x0f,0x00,0xd0,0xb9,0x0e,0x48,0x08,0x30,
//     0x00,0x78,0x00,0xf0,0xf0,0x00,0x30,0x28,0x01,0xd1,0x01,0x20,0x70,0x47,0x0a,0x48,
//     0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x40,0x28,0x01,0xd1,0x01,0x20,0xf5,0xe7,
//     0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x50,0x28,0x01,0xd1,0x01,0x20,
//     0xec,0xe7,0x00,0x20,0xea,0xe7,0x00,0x00,0xe0,0x0f,0x00,0xf0,0x0a,0x48,0x00,0x78,
//     0x06,0x28,0x0e,0xd1,0x08,0x48,0x00,0x1d,0x00,0x78,0x00,0xf0,0x0f,0x00,0x40,0xb9,
//     0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x30,0x28,0x01,0xd1,0x01,0x20,
//     0x70,0x47,0x00,0x20,0xfc,0xe7,0x00,0x00,0xe0,0x0f,0x00,0xf0,0x13,0x48,0x00,0x78,
//     0x06,0x28,0x20,0xd1,0x11,0x48,0x00,0x1d,0x00,0x78,0x00,0xf0,0x0f,0x00,0xd0,0xb9,
//     0x0e,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x30,0x28,0x01,0xd1,0x01,0x20,
//     0x70,0x47,0x0a,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x40,0x28,0x01,0xd1,
//     0x01,0x20,0xf5,0xe7,0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x50,0x28,
//     0x01,0xd1,0x01,0x20,0xec,0xe7,0x00,0x20,0xea,0xe7,0x00,0x00,0xe0,0x0f,0x00,0xf0,
//     0x0a,0x48,0x00,0x78,0x06,0x28,0x0e,0xd1,0x08,0x48,0x00,0x1d,0x00,0x78,0x00,0xf0,
//     0x0f,0x00,0x40,0xb9,0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x30,0x28,
//     0x01,0xd1,0x01,0x20,0x70,0x47,0x00,0x20,0xfc,0xe7,0x00,0x00,0xe0,0x0f,0x00,0xf0,
//     0x13,0x48,0x00,0x78,0x06,0x28,0x20,0xd1,0x11,0x48,0x00,0x1d,0x00,0x78,0x00,0xf0,
//     0x0f,0x00,0xd0,0xb9,0x0e,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x30,0x28,
//     0x01,0xd1,0x01,0x20,0x70,0x47,0x0a,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,
//     0x40,0x28,0x01,0xd1,0x01,0x20,0xf5,0xe7,0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,
//     0xf0,0x00,0x50,0x28,0x01,0xd1,0x01,0x20,0xec,0xe7,0x00,0x20,0xea,0xe7,0x00,0x00,
//     0xe0,0x0f,0x00,0xf0,0x0a,0x48,0x00,0x78,0x06,0x28,0x0e,0xd1,0x08,0x48,0x00,0x1d,
//     0x00,0x78,0x00,0xf0,0x0f,0x00,0x40,0xb9,0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,
//     0xf0,0x00,0x30,0x28,0x01,0xd1,0x01,0x20,0x70,0x47,0x00,0x20,0xfc,0xe7,0x00,0x00,
//     0xe0,0x0f,0x00,0xf0,0x0a,0x48,0x00,0x78,0x06,0x28,0x0e,0xd1,0x08,0x48,0x00,0x1d,
//     0x00,0x78,0x00,0xf0,0x0f,0x00,0x40,0xb9,0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,
//     0xf0,0x00,0x30,0x28,0x01,0xd1,0x01,0x20,0x70,0x47,0x00,0x20,0xfc,0xe7,0x00,0x00,
//     0xe0,0x0f,0x00,0xf0,0x0a,0x48,0x00,0x78,0x06,0x28,0x0e,0xd1,0x08,0x48,0x00,0x1d,
//     0x00,0x78,0x00,0xf0,0x0f,0x00,0x40,0xb9,0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,
//     0xf0,0x00,0x50,0x28,0x01,0xd1,0x01,0x20,0x70,0x47,0x00,0x20,0xfc,0xe7,0x00,0x00,
//     0xe0,0x0f,0x00,0xf0,0x0c,0x20,0x00,0xf0,0x2f,0xf8,0x0c,0x20,0x01,0x21,0x81,0x40,
//     0x0d,0x4a,0x11,0x60,0x00,0xbf,0x11,0x20,0x00,0xf0,0x26,0xf8,0x11,0x20,0x01,0x21,
//     0x81,0x40,0x09,0x4a,0x12,0x1f,0x11,0x60,0x00,0xbf,0x0c,0xe0,0x0c,0x20,0x00,0xf0,
//     0x31,0xf8,0x64,0x20,0x00,0xf0,0x0a,0xf8,0x0c,0x20,0x00,0xf0,0x2b,0xf8,0x4f,0xf4,
//     0x61,0x70,0x00,0xf0,0x03,0xf8,0xf1,0xe7,0x0c,0x05,0x00,0x50,0x01,0xb5,0x06,0xe0,
//     0x00,0x98,0x40,0x1e,0x00,0x90,0x40,0xf2,0xe7,0x30,0xff,0xf7,0x93,0xfd,0x00,0x98,
//     0x00,0x28,0xf5,0xd1,0x08,0xbd,0x00,0x00,0xf0,0xb5,0x01,0x21,0x0a,0x46,0x00,0x25,
//     0x2c,0x46,0x2b,0x46,0x41,0xea,0x42,0x06,0x46,0xea,0x85,0x06,0x46,0xea,0x04,0x26,
//     0x46,0xea,0x03,0x47,0x02,0x4e,0x46,0xf8,0x20,0x70,0x00,0xbf,0xf0,0xbd,0x00,0x00,
//     0x00,0x07,0x00,0x50,0x10,0xb5,0x01,0x46,0x01,0x22,0x02,0xfa,0x01,0xf0,0x06,0x4b,
//     0x1a,0x68,0x20,0xea,0x02,0x03,0x04,0x4c,0x24,0x1d,0x23,0x60,0x02,0xea,0x00,0x03,
//     0x24,0x1d,0x23,0x60,0x00,0xbf,0x10,0xbd,0x04,0x05,0x00,0x50,0x6c,0x09,0x00,0x00,
//     0x00,0x00,0x00,0x20,0x04,0x00,0x00,0x00,0x88,0x06,0x00,0x00,0x70,0x09,0x00,0x00,
//     0x04,0x00,0x00,0x20,0x04,0x20,0x00,0x00,0x98,0x06,0x00,0x00,0x00,0x90,0xd0,0x03
// };

// static uint8_t led[]= {
//     0x08,0x20,0x00,0x20,0x8d,0x04,0x00,0x00,0x95,0x04,0x00,0x00,0x97,0x04,0x00,0x00,
//     0x99,0x04,0x00,0x00,0x9b,0x04,0x00,0x00,0x9d,0x04,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x9f,0x04,0x00,0x00,
//     0xa1,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0xa3,0x04,0x00,0x00,0xa5,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,
//     0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0xa7,0x04,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//     0xdf,0xf8,0x0c,0xd0,0x00,0xf0,0x54,0xf8,0x00,0x48,0x00,0x47,0x95,0x08,0x00,0x00,
//     0x08,0x20,0x00,0x20,0x40,0x1e,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,
//     0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,
//     0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,
//     0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,
//     0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,
//     0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,
//     0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,
//     0x00,0xbf,0x00,0xbf,0x00,0xbf,0xc5,0xd1,0x70,0x47,0x00,0x00,0x06,0x48,0x80,0x47,
//     0x06,0x48,0x00,0x47,0xfe,0xe7,0xfe,0xe7,0xfe,0xe7,0xfe,0xe7,0xfe,0xe7,0xfe,0xe7,
//     0xfe,0xe7,0xfe,0xe7,0xfe,0xe7,0xfe,0xe7,0xe5,0x04,0x00,0x00,0x01,0x04,0x00,0x00,
//     0x06,0x4c,0x07,0x4d,0x06,0xe0,0xe0,0x68,0x40,0xf0,0x01,0x03,0x94,0xe8,0x07,0x00,
//     0x98,0x47,0x10,0x34,0xac,0x42,0xf6,0xd3,0xff,0xf7,0x9e,0xff,0xc8,0x09,0x00,0x00,
//     0xe8,0x09,0x00,0x00,0x01,0x48,0x02,0x49,0x08,0x60,0x70,0x47,0x00,0x90,0xd0,0x03,
//     0x00,0x00,0x00,0x20,0x10,0xb5,0x00,0xf0,0x09,0xf9,0x10,0xb1,0x5c,0x48,0x5d,0x49,
//     0x48,0x67,0x00,0xf0,0x1b,0xf9,0x28,0xb1,0x5b,0x48,0x00,0x68,0xc0,0xf3,0x42,0x30,
//     0x5a,0x49,0x08,0x60,0x00,0xf0,0x3c,0xf9,0x28,0xb1,0x59,0x48,0x00,0x68,0x20,0xf0,
//     0x80,0x70,0x57,0x49,0x08,0x60,0x00,0xf0,0x4b,0xf9,0x48,0xb1,0x00,0x20,0x55,0x49,
//     0x08,0x60,0x4f,0xf0,0x80,0x41,0xc1,0xf8,0x10,0x01,0x50,0x49,0x09,0x1f,0x08,0x60,
//     0x00,0xf0,0x68,0xf9,0x18,0xb1,0x03,0x20,0x4c,0x49,0x64,0x31,0x08,0x60,0x00,0xf0,
//     0x79,0xf9,0x68,0xb1,0x05,0x20,0x4c,0x49,0x08,0x60,0x01,0x20,0x4a,0x49,0x78,0x31,
//     0x08,0x60,0x00,0x20,0x48,0x49,0x08,0x31,0x08,0x60,0x3f,0x20,0x09,0x1f,0x08,0x60,
//     0x00,0xf0,0x80,0xf9,0x00,0x28,0x55,0xd0,0x44,0x48,0x00,0x68,0x44,0x49,0x08,0x60,
//     0x42,0x48,0x00,0x1d,0x00,0x68,0x09,0x1d,0x08,0x60,0x40,0x48,0x08,0x30,0x00,0x68,
//     0x09,0x1d,0x08,0x60,0x3d,0x48,0x0c,0x30,0x00,0x68,0x09,0x1d,0x08,0x60,0x3b,0x48,
//     0x10,0x30,0x00,0x68,0x09,0x1d,0x08,0x60,0x38,0x48,0x14,0x30,0x00,0x68,0x09,0x1d,
//     0x08,0x60,0x36,0x48,0x18,0x30,0x00,0x68,0x35,0x49,0x20,0x31,0x08,0x60,0x33,0x48,
//     0x1c,0x30,0x00,0x68,0x09,0x1d,0x08,0x60,0x30,0x48,0x20,0x30,0x00,0x68,0x09,0x1d,
//     0x08,0x60,0x2e,0x48,0x24,0x30,0x00,0x68,0x09,0x1d,0x08,0x60,0x2b,0x48,0x28,0x30,
//     0x00,0x68,0x09,0x1d,0x08,0x60,0x29,0x48,0x2c,0x30,0x00,0x68,0x09,0x1d,0x08,0x60,
//     0x26,0x48,0x30,0x30,0x00,0x68,0x26,0x49,0x40,0x31,0x08,0x60,0x23,0x48,0x34,0x30,
//     0x00,0x68,0x09,0x1d,0x08,0x60,0x21,0x48,0x38,0x30,0x00,0x68,0x09,0x1d,0x08,0x60,
//     0x1e,0x48,0x3c,0x30,0x00,0x68,0x09,0x1d,0x08,0x60,0x1c,0x48,0x40,0x30,0x00,0x68,
//     0x09,0x1d,0x08,0x60,0x00,0xf0,0x48,0xf8,0x30,0xb1,0x13,0x48,0x14,0x30,0x00,0x68,
//     0x00,0xf0,0x4f,0x00,0x17,0x49,0x08,0x60,0x11,0x48,0x74,0x38,0x00,0x68,0x40,0xf4,
//     0x70,0x00,0x0f,0x49,0x74,0x39,0x08,0x60,0x00,0xbf,0x00,0xbf,0x00,0xbf,0xbf,0xf3,
//     0x4f,0x8f,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0x00,0xbf,0xbf,0xf3,
//     0x6f,0x8f,0x00,0xbf,0x00,0xbf,0x00,0xbf,0xff,0xf7,0x3c,0xff,0x10,0xbd,0x00,0x00,
//     0x0d,0xf0,0xad,0xba,0x00,0xc0,0x07,0x40,0x44,0x02,0x00,0x10,0x3c,0x05,0x00,0x40,
//     0xfc,0xed,0x00,0xe0,0x0c,0x01,0x00,0x40,0x10,0x56,0x00,0x40,0x04,0x04,0x00,0x10,
//     0x20,0xc5,0x00,0x40,0xe4,0x0e,0x00,0x40,0x02,0xe0,0x08,0xc8,0x12,0x1f,0x08,0xc1,
//     0x00,0x2a,0xfa,0xd1,0x70,0x47,0x70,0x47,0x00,0x20,0x01,0xe0,0x01,0xc1,0x12,0x1f,
//     0x00,0x2a,0xfb,0xd1,0x70,0x47,0x00,0x00,0x13,0x48,0x00,0x78,0x06,0x28,0x20,0xd1,
//     0x11,0x48,0x00,0x1d,0x00,0x78,0x00,0xf0,0x0f,0x00,0xd0,0xb9,0x0e,0x48,0x08,0x30,
//     0x00,0x78,0x00,0xf0,0xf0,0x00,0x30,0x28,0x01,0xd1,0x01,0x20,0x70,0x47,0x0a,0x48,
//     0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x40,0x28,0x01,0xd1,0x01,0x20,0xf5,0xe7,
//     0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x50,0x28,0x01,0xd1,0x01,0x20,
//     0xec,0xe7,0x00,0x20,0xea,0xe7,0x00,0x00,0xe0,0x0f,0x00,0xf0,0x0a,0x48,0x00,0x78,
//     0x06,0x28,0x0e,0xd1,0x08,0x48,0x00,0x1d,0x00,0x78,0x00,0xf0,0x0f,0x00,0x40,0xb9,
//     0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x30,0x28,0x01,0xd1,0x01,0x20,
//     0x70,0x47,0x00,0x20,0xfc,0xe7,0x00,0x00,0xe0,0x0f,0x00,0xf0,0x13,0x48,0x00,0x78,
//     0x06,0x28,0x20,0xd1,0x11,0x48,0x00,0x1d,0x00,0x78,0x00,0xf0,0x0f,0x00,0xd0,0xb9,
//     0x0e,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x30,0x28,0x01,0xd1,0x01,0x20,
//     0x70,0x47,0x0a,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x40,0x28,0x01,0xd1,
//     0x01,0x20,0xf5,0xe7,0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x50,0x28,
//     0x01,0xd1,0x01,0x20,0xec,0xe7,0x00,0x20,0xea,0xe7,0x00,0x00,0xe0,0x0f,0x00,0xf0,
//     0x0a,0x48,0x00,0x78,0x06,0x28,0x0e,0xd1,0x08,0x48,0x00,0x1d,0x00,0x78,0x00,0xf0,
//     0x0f,0x00,0x40,0xb9,0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x30,0x28,
//     0x01,0xd1,0x01,0x20,0x70,0x47,0x00,0x20,0xfc,0xe7,0x00,0x00,0xe0,0x0f,0x00,0xf0,
//     0x13,0x48,0x00,0x78,0x06,0x28,0x20,0xd1,0x11,0x48,0x00,0x1d,0x00,0x78,0x00,0xf0,
//     0x0f,0x00,0xd0,0xb9,0x0e,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,0x30,0x28,
//     0x01,0xd1,0x01,0x20,0x70,0x47,0x0a,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,0xf0,0x00,
//     0x40,0x28,0x01,0xd1,0x01,0x20,0xf5,0xe7,0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,
//     0xf0,0x00,0x50,0x28,0x01,0xd1,0x01,0x20,0xec,0xe7,0x00,0x20,0xea,0xe7,0x00,0x00,
//     0xe0,0x0f,0x00,0xf0,0x0a,0x48,0x00,0x78,0x06,0x28,0x0e,0xd1,0x08,0x48,0x00,0x1d,
//     0x00,0x78,0x00,0xf0,0x0f,0x00,0x40,0xb9,0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,
//     0xf0,0x00,0x30,0x28,0x01,0xd1,0x01,0x20,0x70,0x47,0x00,0x20,0xfc,0xe7,0x00,0x00,
//     0xe0,0x0f,0x00,0xf0,0x0a,0x48,0x00,0x78,0x06,0x28,0x0e,0xd1,0x08,0x48,0x00,0x1d,
//     0x00,0x78,0x00,0xf0,0x0f,0x00,0x40,0xb9,0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,
//     0xf0,0x00,0x30,0x28,0x01,0xd1,0x01,0x20,0x70,0x47,0x00,0x20,0xfc,0xe7,0x00,0x00,
//     0xe0,0x0f,0x00,0xf0,0x0a,0x48,0x00,0x78,0x06,0x28,0x0e,0xd1,0x08,0x48,0x00,0x1d,
//     0x00,0x78,0x00,0xf0,0x0f,0x00,0x40,0xb9,0x05,0x48,0x08,0x30,0x00,0x78,0x00,0xf0,
//     0xf0,0x00,0x50,0x28,0x01,0xd1,0x01,0x20,0x70,0x47,0x00,0x20,0xfc,0xe7,0x00,0x00,
//     0xe0,0x0f,0x00,0xf0,0x0c,0x20,0x00,0xf0,0x65,0xf8,0x0c,0x20,0x01,0x21,0x81,0x40,
//     0x28,0x4a,0x11,0x60,0x00,0xbf,0x11,0x20,0x00,0xf0,0x5c,0xf8,0x12,0x20,0x00,0xf0,
//     0x59,0xf8,0x13,0x20,0x00,0xf0,0x56,0xf8,0x14,0x20,0x00,0xf0,0x53,0xf8,0x11,0x20,
//     0x00,0xf0,0x66,0xf8,0x12,0x20,0x00,0xf0,0x63,0xf8,0x13,0x20,0x00,0xf0,0x60,0xf8,
//     0x14,0x20,0x00,0xf0,0x5d,0xf8,0x33,0xe0,0x11,0x20,0x00,0xf0,0x61,0xf8,0x64,0x20,
//     0x00,0xf0,0x32,0xf8,0x12,0x20,0x00,0xf0,0x5b,0xf8,0x64,0x20,0x00,0xf0,0x2c,0xf8,
//     0x13,0x20,0x00,0xf0,0x55,0xf8,0x64,0x20,0x00,0xf0,0x26,0xf8,0x14,0x20,0x00,0xf0,
//     0x4f,0xf8,0x64,0x20,0x00,0xf0,0x20,0xf8,0x11,0x20,0x00,0xf0,0x49,0xf8,0x64,0x20,
//     0x00,0xf0,0x1a,0xf8,0x12,0x20,0x00,0xf0,0x43,0xf8,0x64,0x20,0x00,0xf0,0x14,0xf8,
//     0x13,0x20,0x00,0xf0,0x3d,0xf8,0x64,0x20,0x00,0xf0,0x0e,0xf8,0x14,0x20,0x00,0xf0,
//     0x37,0xf8,0x64,0x20,0x00,0xf0,0x08,0xf8,0x4f,0xf4,0x16,0x70,0x00,0xf0,0x04,0xf8,
//     0xca,0xe7,0x00,0x00,0x0c,0x05,0x00,0x50,0x01,0xb5,0x06,0xe0,0x00,0x98,0x40,0x1e,
//     0x00,0x90,0x40,0xf2,0xe7,0x30,0xff,0xf7,0x5d,0xfd,0x00,0x98,0x00,0x28,0xf5,0xd1,
//     0x08,0xbd,0x00,0x00,0xf0,0xb5,0x01,0x21,0x0a,0x46,0x00,0x25,0x2c,0x46,0x2b,0x46,
//     0x41,0xea,0x42,0x06,0x46,0xea,0x85,0x06,0x46,0xea,0x04,0x26,0x46,0xea,0x03,0x47,
//     0x02,0x4e,0x46,0xf8,0x20,0x70,0x00,0xbf,0xf0,0xbd,0x00,0x00,0x00,0x07,0x00,0x50,
//     0x01,0x21,0x81,0x40,0x01,0x4a,0x11,0x60,0x70,0x47,0x00,0x00,0x08,0x05,0x00,0x50,
//     0x10,0xb5,0x01,0x46,0x01,0x22,0x02,0xfa,0x01,0xf0,0x06,0x4b,0x1a,0x68,0x20,0xea,
//     0x02,0x03,0x04,0x4c,0x24,0x1d,0x23,0x60,0x02,0xea,0x00,0x03,0x24,0x1d,0x23,0x60,
//     0x00,0xbf,0x10,0xbd,0x04,0x05,0x00,0x50,0xe8,0x09,0x00,0x00,0x00,0x00,0x00,0x20,
//     0x04,0x00,0x00,0x00,0x88,0x06,0x00,0x00,0xec,0x09,0x00,0x00,0x04,0x00,0x00,0x20,
//     0x04,0x20,0x00,0x00,0x98,0x06,0x00,0x00,0x00,0x90,0xd0,0x03,
// };

uint8_t buff[sector_size+0x10] = {0};

#include "spi_driver.h"
#include "usart_driver.h"
#include "scheduler.h"

extern ARM_DRIVER_USART Driver_USART1;
extern ARM_DRIVER_USART Driver_USART2;

static uint8_t rxBuffer[sector_size+0x10] = {0};
static uint8_t txBuffer[0x100] = {0};

#define code_bin beep

void power_manage(void)
{
	// __WFI();
}
void platform_scheduler(void)
{
	app_sched_execute();
	power_manage();
}
void timer_config(void)
{
	// 定时 TIMER 设定
	TIM_TimeBaseInitTypeDef	TIM_TimeBaseInitStrue;

	RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM3, ENABLE);
	TIM_DeInit(TIM3);
	TIM_TimeBaseInitStrue.TIM_Period = 999;			            //设置自动重装载值
	TIM_TimeBaseInitStrue.TIM_Prescaler = 71;		            //预分频系数 - 1000k
	TIM_TimeBaseInitStrue.TIM_CounterMode = TIM_CounterMode_Up;	//计数器向上溢出
	TIM_TimeBaseInitStrue.TIM_ClockDivision = TIM_CKD_DIV1;		//时钟的分频
	TIM_TimeBaseInitStrue.TIM_RepetitionCounter = 0;
	TIM_TimeBaseInit(TIM3, &TIM_TimeBaseInitStrue);				//TIM初始化设置
	TIM_ClearFlag(TIM3, TIM_FLAG_Update);
	TIM_ITConfig(TIM3, TIM_IT_Update, ENABLE);
	// TIM_Cmd(TIM3, ENABLE);	//使能TIM
}
void rtc_config(void)
{
	RCC_APB1PeriphClockCmd(RCC_APB1Periph_PWR | RCC_APB1Periph_BKP, ENABLE);
	PWR_BackupAccessCmd(ENABLE);
	RCC_HSEConfig(RCC_HSE_ON);
	while (RCC_GetFlagStatus(RCC_FLAG_HSERDY) == RESET) {}
	RCC_RTCCLKConfig(RCC_RTCCLKSource_HSE_Div128);
	RCC_RTCCLKCmd(ENABLE);

	RTC_EnterConfigMode();
	RTC_WaitForSynchro();
	RTC_WaitForLastTask();
	RTC_ITConfig(RTC_IT_SEC, ENABLE);
	RTC_WaitForLastTask();
	RTC_SetPrescaler(32767);
	RTC_WaitForLastTask();
	RTC_ExitConfigMode();
}
void NVIC_Configuration(void)
{
	NVIC_InitTypeDef NVIC_InitStructure;

	/* Configure one bit for preemption priority */
	NVIC_PriorityGroupConfig(NVIC_PriorityGroup_1);

	/* RTC中断 */
	NVIC_InitStructure.NVIC_IRQChannel = RTC_IRQn;
	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 1;
	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
	NVIC_Init(&NVIC_InitStructure);

	/* TIM3 中断 */
	NVIC_InitStructure.NVIC_IRQChannel = TIM3_IRQn;
	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 1;
	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
	NVIC_Init(&NVIC_InitStructure);
}
extern void rtc_2hz_routine(void);
void RTC_IRQHandler(void)
{
	// platform_simple_evt_put(rtc_2hz_routine);
	RTC_ClearFlag(RTC_FLAG_SEC);
}

extern void timer_1ms_routine(void);
void TIM3_IRQHandler(void)
{
	if(TIM_GetITStatus(TIM3, TIM_IT_Update) != RESET) {
		platform_simple_evt_put(timer_1ms_routine);
	}
	TIM_ClearITPendingBit(TIM3, TIM_FLAG_Update);
}
void rtc_2hz_routine(void){
    ;
}
void timer_1ms_routine(void){
    
}
uint16_t up_flag=0;
bool spi_flag=false;
uint16_t spi_length;
int main(void)
{
    uint32_t addr;
    SystemInit();
    APP_SCHED_INIT(16, 32);
    // timer_config();
    // NVIC_Configuration();
    // rtc_config();
    spi_init();
    usart_init();
    Driver_USART1.Receive(rxBuffer, sizeof(rxBuffer));
    // Driver_USART2.Receive(rxBuffer, sizeof(rxBuffer));

    swd_init_debug();


    // for(addr = 0; addr < sizeof(code_bin); addr += sector_size)
    // {
    //     swd_read_memory(Flash_Start_Addr + addr, buff, sector_size);
    //     printf("Erase:");
    //     for(uint32_t i = 0; i < sector_size; i++) printf("%02X ", buff[i]);
    //     printf("\r\n");
    // }

    // for(addr = 0; addr < sizeof(code_bin); addr += sector_size)
    // {
    //     target_flash_program_page(Flash_Start_Addr + addr, &code_bin[addr], sector_size);
    // }

    // for(addr = 0; addr < sizeof(code_bin); addr += sector_size)
    // {
    //     swd_read_memory(Flash_Start_Addr + addr, buff, sector_size);
    //     printf("Read:");
    //     for(uint32_t i = 0; i < sector_size; i++) printf("%02X ", buff[i]);
    //     printf("\r\n");
    // }
    // swd_set_target_reset(0);//复位运行
    flash_is_busy();
    while(1)
    {
        platform_scheduler();
        // if(up_flag>0){
        //     switch (up_flag)
        //     {
        //         case 1:
        //             // spi_wr(rxBuffer, txBuffer, 0x10);
        //             break;
        //         case 0x7F:  // init flash
        //             // flash_chip_erase();
        //             // flash_wait_idle();
        //         break;
        //         case 0x75:  // write data block
        //             flash_write(buff+4,0x1F0000+buff[4]*4,4);
        //             flash_wait_idle();
        //             flash_write(buff+8,buff[4]*0x1000,0x1000);
        //             flash_wait_idle();
        //         break;
        //         case 0x71:  // program from flash
        //         // if addr
        //         // read flash to buff
        //         // program addr,buff[3],sector
        //         // for(addr = 0; addr < sizeof(code_bin); addr += sector_size)
        //         // {
        //         //     target_flash_program_page(Flash_Start_Addr + addr, &buff[addr], sector_size);
        //         // }
        //         break;
            
        //         default:
        //             break;
        //     }
        //     up_flag = 0;
        // }
    }
}

typedef struct
{
    uint8_t *data;
} sUART_EVT;

void echo(sUART_EVT* ue, uint16_t size){
    uint16_t length = (ue->data[2]<<8) | ue->data[3];
    Driver_USART1.Send(ue->data+4, length);
}
void flash_init(void){
    flash_wait_idle_q();
    flash_chip_erase_q();
    flash_wait_idle_q();
}
void flash_write_block(sUART_EVT* ue, uint16_t size){
    uint8_t i;
    uint16_t sn = ue->data[0];
    uint32_t addr = (ue->data[1]<<16) | (ue->data[2]<<8) | ue->data[3];
    flash_wait_idle_q();
    flash_write_q(ue->data,0x1F0000+sn*4,0x4);
    flash_wait_idle_q();
    for(i=0;i<16;i++){
        flash_write_q(ue->data+4+i*0x100,sn*0x1000+i*0x100,0x100);
        flash_wait_idle_q();
    }
}
void flash_read_test(void){
    static uint8_t _buf[0x10];
    flash_wait_idle_q();
    flash_read_q(_buf,0x0,0x10);
}

struct sbin_head
{
    uint8_t sn;
    uint8_t addr[3];
}bin_head;

bool volatile program_state = false;
bool volatile program_wait = false;
static uint8_t _buf1[0x10] __attribute__((section(".ARM.__at_0x20000020")));
static uint8_t _buf2[0x10];
void program_from_flash(void){
    // static uint8_t _buf2[0x10];
    static uint32_t _addr_head=0x1F0000;
    static uint32_t _addr_bin=0x1F0000;
    static uint32_t _addr_prog;
    program_state = true;

    target_flash_init(Flash_Start_Addr);
    target_flash_erase_chip();
    while(1){
        _buf1[0] = 0x03;
        _buf1[1] = (_addr_head >> 16) & 0xFF;
        _buf1[2] = (_addr_head >> 8) & 0xFF;
        _buf1[3] = _addr_head & 0xFF;
        program_wait = true;
        spi_wr(_buf1,_buf2,8);
        while(program_wait);
        if(_buf2[5]!=0xFF){
            _addr_bin = _buf2[4]*0x1000;
            _addr_prog = (_buf2[5]<<16) | (_buf2[6]<<8) | _buf2[7];
            _buf1[0] = 0x03;
            _buf1[1] = (_addr_bin >> 16) & 0xFF;
            _buf1[2] = (_addr_bin >> 8) & 0xFF;
            _buf1[3] = _addr_bin & 0xFF;
            program_wait = true;
            spi_wr(_buf1,buff,0x1000+4);
            while(program_wait);
            Driver_USART1.Send(_buf2+4, 4);
            target_flash_program_page(Flash_Start_Addr + _addr_prog, &buff[4], sector_size);
        }else{
            break;
        }
        _addr_head+=4;
    }
    program_state = false;
}
// head: 0x5e
// cmd: 0x00-0x7F, 0x8000-0xFFFF
// length: 0x0000-0xFFFF
// payload: xxxx
// CRC: xx

// init:0x5E,0x7F,0x00,0x00
// write datablock: 0x5E,0x75,0x10,0x04, 8bit sn, 24bit addr, 4k data, crc
// test program: 0x5E,0x71,0x00,0x00, crc
void uart_parser(uint16_t max)
{
    sUART_EVT uart_evt;
    uint16_t i=0;
    while(i<max){
        if(rxBuffer[i]==0x5E){
            switch (rxBuffer[i+1])
            {
                case 0x7F:
				flash_init();
                return;
                case 0x76:
                platform_simple_evt_put(flash_read_test);
                break;
                case 0x75:
                uart_evt.data = rxBuffer+4;
                app_sched_event_put(&uart_evt,sizeof(uart_evt),(app_sched_event_handler_t)flash_write_block);
                return;
                case 0x71:
                platform_simple_evt_put(program_from_flash);
                return;
                case 0x77:  // echo
                uart_evt.data = rxBuffer;
                app_sched_event_put(&uart_evt,sizeof(uart_evt),(app_sched_event_handler_t)echo);
                return;
                // default:
                // return;
            }
        }
        i+=1;
    }
}

void USART1_Callback(uint32_t event)
{
    if(event & ARM_USART_EVENT_RX_TIMEOUT)
    {
        Driver_USART1.Control(ARM_USART_ABORT_RECEIVE, 1);
        uint32_t length = Driver_USART1.GetRxCount();
        // memcpy(txBuffer, rxBuffer, length);
        // Driver_USART1.Send(txBuffer, length);
        Driver_USART1.Receive(rxBuffer, sizeof(rxBuffer));
        uart_parser(length);
    }
}

void SPI1_Callback(uint32_t event)
{
    // GPIO_PinWrite(GPIOA,4,1);
    if(event & ARM_SPI_EVENT_TRANSFER_COMPLETE)
    {
        if(!program_state){
            Driver_SPI1.Control(ARM_SPI_CONTROL_SS, ARM_SPI_SS_INACTIVE);
            if(spi_queue[(sq_r+SPI_QUEUE_LENGTH-1)&(SPI_QUEUE_LENGTH-1)].callback!=NULL){
                if(spi_queue[(sq_r+SPI_QUEUE_LENGTH-1)&(SPI_QUEUE_LENGTH-1)].callback(spi_queue[(sq_r+SPI_QUEUE_LENGTH-1)&(SPI_QUEUE_LENGTH-1)].r)==true){
                    sq_r = (sq_r+SPI_QUEUE_LENGTH-1)&(SPI_QUEUE_LENGTH-1);
                }
            }
            platform_simple_evt_put(spi_queue_dispatch);
        }else{
            Driver_SPI1.Control(ARM_SPI_CONTROL_SS, ARM_SPI_SS_INACTIVE);
            program_wait = false;
        }
    }
}

int fputc(int ch, FILE *f)
{
    while(USART_GetFlagStatus(USART1, USART_FLAG_TXE) == RESET);
    USART_SendData(USART1, ch);
    return ch;
}


// void USART2_Callback(uint32_t event)
// {
//     if(event & ARM_USART_EVENT_RX_TIMEOUT)
//     {
//         Driver_USART2.Control(ARM_USART_ABORT_RECEIVE, 1);
//         uint32_t length = Driver_USART2.GetRxCount();
//         memcpy(txBuffer, rxBuffer, length);
//         Driver_USART2.Receive(rxBuffer, sizeof(rxBuffer));
//         Driver_USART1.Send(txBuffer, length);
//     }
// }
